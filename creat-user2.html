<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link rel="stylesheet" type="text/css" href="css/fontawesome.css">
    <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:ital,wght@0,400;1,300&amp;display=swap" rel="stylesheet">
    <title>creat user 2</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="sc.js"></script>
</head>

<body>
    <section class="application-layout">
        <div class="application-tittle">
            <h1>User-Account</h1>
            <button class="btn" onclick="creatUser(true)">Craet User</button>
            <div class="search-bar">
                <input type="text" name="search" placeholder="search" class="search" onkeyup="searchBar()" />
                <i class="fas fa-search" onclick="searchBar()"></i>
            </div>
        </div>
        <section id="userList" class="user-list">
            <!-- <div class="user" onclick="myProfile(this)">
                <i class="fa fa-user" aria-hidden="true"></i>
                <img src="img/aarti.jpg">
                <p>My Profile</p>
            </div>
            <div class="user">
                <input type="text" name="search" placeholder="search" class="search" />
            </div> -->
            <!-- <div class="user-list-heading">
                    <p>User List</h2>
                </div> -->
            <div class="list-parent"></div>
        </section>
        <section class="display-area">
            <!-- my profile details -->
            <div class="userProfile">
            </div>
            <div class="my-profile">
                <i class="fas fa-user-edit user-edit" onclick="edit()"></i>
                <i class="far fa-image"></i>
                <div>
                    <img src="img/aarti.jpg">
                    <h2>aarti Jagdale</h2>
                    <p>student</p>
                    <button class="btn" onclick="goBack(true)">Go Back</button>
                </div>
            </div>
            <!--end my profilr details  -->
            <!-- display user details -->

        </section>
        <section class="login-form">
            <form action="http://localhost:2000" method="" onsubmit="submitData(event, this)">
                <h2>Login</h2>
                <div class="user-fill">
                    <input type="text" name="firstname" id="user-name" required="" class="form-field" />
                    <label id="form-label">Name</label>
                </div>
                <div class="user-fill">
                    <input type="text" name="email" id="user-email" required="" class="form-field" />
                    <label id="form-label">Email Address </label>
                </div>
                <div class="user-fill">
                    <input type="file" name="image" onchange="editProfileImg('.profile-img','.profile-img-input')"
                        class="profile-img-input form-field"><br>
                        <label id="form-label">Profile Pic</label>
                    <img src="" class="profile-img">
                </div>
                <div class="user-fill">
                    <!-- <input type="text" name="" id="user-profession" /> -->
                    <select id="user-profession" name="job" class="form-field">
                        <option>select your profession</option>
                        <option>Student</option>
                        <option>web Devloper</option>
                        <option>Software Engineer</option>
                        <option>Teacher</option>
                        <option>Indian Army</option>
                        <option>Acter</option>
                    </select>
                </div>
                <div class="user-fill">
                    <input type="number" name="phone" id="user-contact" required="" class="form-field">
                    <label id="form-label">Contact No</label>
                </div>
                <div class="user-fill">
                    <input type="password" name="password" id="user-password" required="" class="form-field" />
                    <label id="form-label">password</label>
                </div>
                <div class="btn-parent">
                    <button class="btn" id="submit">submit</button>
                    <!-- onsubmit="CreatUserList()" -->
                    <input type="button" value="Goback" class="btn back-btn" onclick="goBack()">
                </div>
            </form>
        </section>
        <!-- <div class="userProfile"></div> -->

    </section>
    <!-- scripting -->
    <script>
        const userList = document.getElementById("userList");
        const loginForm = document.querySelector(".login-form");
        const userProfile = document.querySelector(".userProfile");
        const myprofile = document.querySelector(".my-profile");
        const user = document.querySelector(".user");
        const input = document.querySelectorAll(".login-form input")
        const parentUserList = document.querySelector(".list-parent");
        // var x = userEmail.value.indexOf("@");
        const submit = document.getElementById("submit");
        const userName = document.getElementById("user-name");
        const userEmail = document.getElementById("user-email");
        const userprofession = document.getElementById("user-profession");
        const userpassword = document.getElementById("user-password");
        const userContact = document.getElementById("user-contact");
        const userProfileImg = document.querySelector(".profile-img");
        var form = document.querySelector("form");
        // const userProfile = document.querySelector(".userProfile");

        function creatUser(y) {
            userList.style.display = "none";
            userProfile.style.display = "none";
            myprofile.style.display = "none";
            loginForm.style.display = "block";
        }

        // onsubmit

        function submitData(e, el) {
            e.preventDefault();

            var button = document.querySelector("#submit");
            button.innerHTML = "submiting.."

            const url = el.action
            // var x = urlString();
            var payLoad = payLoadObject();

            $.post(url, payLoad, function (data, status) {
                alert("data save successfully !")
                button.innerHTML = "submit";
                CreatUserList();
                form.reset();
                userProfileImg.src = "";
                // userProfileImg.classList.remove("profile-img");
                userProfileImg.style.display = " none";
            }).catch(function (e) {
                console.log("something is wrong!", e)
                alert("something is wrong !");
                button.innerHTML = "submit";
            })

        }

        function payLoadObject() {
            var formFieldValues = document.querySelectorAll(".form-field");
            var x = "";
            var obj = {}
            for (i = 0; i < formFieldValues.length; i++) {
                var item = formFieldValues[i];
                var itemname = item.name;
                var itemvalue = item.value;
                if (itemname == "image") {
                    itemvalue = userProfileImg.src;
                }
                obj[itemname] = itemvalue;
                // arr.push(itemname+":"+itemvalue);
                // obj[i]={infoname:value};
            }
            return JSON.stringify(obj);
        }


        // function urlString() {
        //     var formFieldValues = document.querySelectorAll(".form-field");
        //     var str = "";
        //     var querystring;
        //     for (i = 0; i < formFieldValues.length; i++) {
        //         var item = formFieldValues[i];
        //         var name = item.name;
        //         var value = item.value;
        //         if(name == "image"){
        //             value = userProfileImg.src;
        //         }

        //         if (i == 0) {
        //             querystring = "?" + name + "=" + value;
        //         }
        //         else {
        //             querystring = "&" + name + "=" + value;
        //         }
        //         str += querystring;
        //     }
        //     return str;
        // }



        // goBack button
        function goBack(x) {
            // const loginForm = document.querySelector(x);
            if (x == true) {
                userProfile.style.display = "none";
                userList.style.display = "inline-block";
                myprofile.style.display = "none";
                form.reset();
                userProfileImg.src = "";
                userProfileImg.style.display = " none";

            } else {
                userList.style.display = "inline-block";
                loginForm.style.display = "none";
            }
        }

        // function myProfile(el) {
        //     myprofile.style.display = "inline-block";
        // }

        // creat user display in user list
        var userData = [];
        var count = 0;
        function CreatUserList() {
            var isFormValid = formValidation();
            if (true || isFormValid === true) {
                creatList();
            }
        }

        // form validation
        function formValidation() {
            var x = userEmail.value.indexOf("@");
            const contLength = userContact.value;
            const passwordLength = userpassword.value;
            if (userName.value == "") {
                alert("name can't be empty")
                return false;
            }
            else if (x < 3) {
                alert("enter valid email address")
                return false;
            }
            else if (userprofession.value == "select your profession") {
                alert("profession can't be empty")
                return false;
            }
            else if (contLength.length < 10 || contLength.length > 10) {
                alert("must be 10 digit long contact number")
                return false;
            }
            else if (passwordLength.length < 4) {
                alert("password must be 4 digit long")
                return false;
            }
            else {
                return true;
            }
        }

        // profile img 
        function editProfileImg(x, y) {
            const profileImg = document.querySelector(x);
            const file = document.querySelector(y).files[0];
            userProfileImg.style.display = "block";
            const reader = new FileReader();

            reader.addEventListener("load", function () {
                // convert image file to base64 string
                profileImg.src = reader.result;
            }, false);

            if (file) {
                reader.readAsDataURL(file);
            }

        }
        // 

        function creatList() {
            var obj = {};
            const userProfileImg = document.querySelector(".profile-img");
            obj.name = userName.value;
            obj.email = userEmail.value;
            obj.profession = userprofession.value;
            obj.contact = userContact.value;
            obj.img = userProfileImg.src;
            if (userProfileImg.currentSrc == "") {
                obj.img = "img/user.jpg"
            }
            userData.push(obj);
            // var data = userData[count]
            var Ulist = document.createElement("div");
            Ulist.innerHTML =
                "<img src='" + obj.img + "' class='user-img'/>" +
                // "<i class='fa fa-user user-font' aria-hidden='true'></i>" +
                "<p id='user-display-name'>" + obj.name + "</p>" +
                "<i class='fas fa-angle-down font-down-angle' onclick='accountSetting()'></i>";
            Ulist.classList.add("user");
            userList.style.height = "550px";
            parentUserList.append(Ulist);
            // for (i = 0; i < input.length; i++) {
            //     input[i].value = "";
            // }
            // userProfileImg.src = "";
            userList.style.display = "inline-block";
            loginForm.style.display = "none";

            // this function for display user profile
            Ulist.addEventListener("click", function () {
                // userList.style.display = "none";
                userProfile.style.display = "inline-block";
                var indexNo = userData.indexOf(obj);
                userProfile.innerHTML =
                    "<i class='fas fa-trash-alt user-edit' onclick='deletUser(" + indexNo + ")'></i>" +
                    "<i class='fas fa-user-edit user-edit' onclick='edit(" + indexNo + ")'></i>" +
                    // "<i class='fa fa-user profile-font' aria-hidden='true'></i>" +
                    "<img src='" + obj.img + "' class='profile-font p-img-editPage'/>" +
                    "<i class='far fa-image profile-edit'><input type='file' onchange='editProfileImg(\".p-img-editPage\",\".font-input\")' class='font-input'></i> " +
                    "<h2>" + obj.name + "</h2>" +
                    "<p id='profession'>" + obj.profession + "</p>" +
                    "<p id='email'>" + obj.email + "</p>" +
                    "<p id ='contact'>" + obj.contact + "</p>" +
                    "<button class='btn' onclick='goBack(true)'>Go Back</button>";
            })
        }
        // edit peofile
        var alredyEditMode = false;
        function edit(indexNo) {
            // save editaed data here
            if (alredyEditMode == true) return;

            alredyEditMode = true;
            var editedData = userData[indexNo];


            var saveBtn = document.createElement("span");
            saveBtn.innerHTML = "<button class='save-btn btn'>save</button>"
            userProfile.append(saveBtn);
            const profileEdit = document.querySelector(".profile-edit");
            profileEdit.style.visibility = "visible";

            var ProfileName = userProfile.querySelector("h2");
            var prfileProfession = userProfile.querySelector("#profession");
            var prfileEmail = userProfile.querySelector("#email");
            var prfileContact = userProfile.querySelector("#contact");
            var profileImage = userProfile.querySelector(".p-img-editPage");


            ProfileName.innerHTML = "<input type='text' name='name' placeholder='Name' value='" + editedData.name + "' id='edit-name' class='edit-input'/>";
            prfileProfession.innerHTML = "<input type='text' name='' placeholder='Profession' value='" + editedData.profession + "' id='edit-profession' class='edit-input'/>";
            prfileEmail.innerHTML = "<input type='text' name='email' placeholder='Email' value='" + editedData.email + "' id='edit-email' class='edit-input'/>";
            prfileContact.innerHTML = "<input type='number' placeholder ='Contact No' value='" + editedData.contact + "' id='edit-contact' class='edit-input'/>";
            profileImage.src = editedData.img;

            saveBtn.addEventListener("click", function () {
                alredyEditMode = false;
                var saveName = document.getElementById("edit-name");
                var saveProfession = document.getElementById("edit-profession");
                var saveEmail = document.getElementById("edit-email");
                var saveContact = document.getElementById("edit-contact");
                var saveImage = profileImage;


                var userDisplayName = document.querySelectorAll("#user-display-name");
                var uderDisplayImage = document.querySelectorAll(".user img")

                editedData.name = saveName.value;
                editedData.profession = saveProfession.value;
                editedData.email = saveEmail.value;
                editedData.contact = saveContact.value;
                editedData.img = saveImage.src;

                ProfileName.innerHTML = saveName.value;
                prfileProfession.innerHTML = saveProfession.value;
                prfileEmail.innerHTML = saveEmail.value;
                prfileContact.innerHTML = saveContact.value;
                profileImage.src = saveImage.src;
                // userDisplayName

                userDisplayName[indexNo].innerHTML = editedData.name;
                uderDisplayImage[indexNo].src = editedData.img;
                saveBtn.style.display = 'none';
            })

        }

        // search bar filter
        function searchBar() {
            const searchIuput = document.querySelector(".search")
            var filter = searchIuput.value.toUpperCase();
            var UsernameList = document.querySelectorAll(".user p");

            for (i = 0; i < UsernameList.length; i++) {
                if (searchIuput.value == "") {
                    UsernameList[i].parentElement.style.display = "block";
                }
                txtValue = UsernameList[i].innerText;
                // UsernameList[i].textContent ||
                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    UsernameList[i].style.display = "";
                } else {
                    var parent = UsernameList[i].parentElement;
                    parent.style.display = "none";
                }
            }
        }

        // deletUser
        function deletUser(indexNo) {
            var deletAction = confirm(" you want to delet this user ? ")
            if (deletAction == true) {
                var userDisplayName = document.querySelectorAll("#user-display-name");
                if (indexNo > -1) {
                    userData.splice(indexNo, 1);
                    // var nodlistArr = Array.from(userDisplayName);
                    // nodlistArr.splice(indexNo, 1);
                    userDisplayName[indexNo].parentElement.remove();
                    userProfile.style.display = "none";
                }
            }
        }

        // accountSetting list
        function accountSetting() {

        }

    </script>
</body>

</html>