<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="css/creat-user.css">
    <link rel="stylesheet" type="text/css" href="css/fontawesome.css">
    <title>creat user</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="toast-notification.js"></script>
</head>

<body>

    <section class="application-layout">
        <div class="logo-add">
            <button onclick="loginForm()">+</button>
            <div>Creat User</div>
        </div>
    </section>
    <section id="userList" class="user-list">
        <div class="owner-profile">
            <div class="owner-profile-layout">
                <img src="img/aarti.jpg" class="owner-profile-img">
                <h2>Aarti Jagdale</h2>
            </div>
        </div>
        <div class="list-layout">
            <div class="list-parent"></div>
            <div class="add-user">
                <button onclick="loginForm()">+</button>
                <div>Creat User</div>
            </div>
        </div>
    </section>
    <section class="display-area">
        <div class="userProfile"></div>
    </section>

    <section class="form-section">
        <div id="overlay">
            <div class="login-form">
                <div class="remove-form">
                    <button onclick="removeForm()">x</button>
                </div>
                <form action="http://localhost:2000" method="" onsubmit="submitData(event,this)">
                    <h2>Login</h2>
                    <div class="user-fill">
                        <img src="img/user3.jpg" class="profile-img">
                        <i class="fas fa-user-edit user-edit-font"></i>
                        <input type="file" name="image" onchange="editProfileImg('.profile-img','.profile-img-input')"
                            class="profile-img-input form-field" onfocus="InputFocus(this)"
                            onblur="InputBlur(this)"><br>
                        <label class="img-lable form-label">Profile Picture</label>
                    </div>
                    <div class="user-fill">
                        <input type="text" name="firstname" id="user-name" required="" class="form-field"
                            onfocus="InputFocus(this)" onblur="InputBlur(this)" />
                        <label class="labelName form-label">Name</label>
                    </div>
                    <div class="user-fill">
                        <input type="text" name="email" id="user-email" required="" class="form-field"
                            onfocus="InputFocus(this)" onblur="InputBlur(this)" />
                        <label class="labelemail form-label">Email Address </label>
                    </div>
                    <div class="user-fill">
                        <div class="user-fill">
                            <select id="user-profession" name="job" required="" class="form-field selector-css">
                                <option>Select Your Profession</option>
                                <option>Student</option>
                                <option>Web Devloper</option>
                                <option>Software Engineer</option>
                                <option>Teacher</option>
                                <option>Army</option>
                                <option>Acter</option>
                            </select>
                        </div>
                    </div>
                    <div class="user-fill">
                        <input type="password" name="password" id="user-password" required="" class="form-field"
                            onfocus="InputFocus(this)" onblur="InputBlur(this)" />
                        <label class="labelpassword form-label">Password</label>
                    </div>
                    <button type="submit" class="btn" id="submit">submit</button>
                    <!-- onclick="toastNotification('your login successfully !!',true)" -->
                    <!-- <input type="reset" value="reset" class="btn reset-btn"> -->
                    <!-- <button type="submit" class="btn"
                        onclick="toastNotification('failed to login ..try agin',false)">submit2</button> -->
                </form>
            </div>
        </div>
    </section>
    <section class="toast-notification"></section>

</body>
<script>
    const loginSection = document.querySelector(".login-form");
    const frontLogo = document.querySelector("logo-add");
    const userProfileImg = document.querySelector(".profile-img");
    const overlay = document.getElementById("overlay");
    const userProfile = document.querySelector(".userProfile");
    const userList = document.querySelector(".user-list");
    const applicationLayout = document.querySelector(".application-layout");
    var form = document.querySelector("form");
    const parentUserList = document.querySelector(".list-parent");
    const userName = document.getElementById("user-name");
    const userEmail = document.getElementById("user-email");
    const userprofession = document.getElementById("user-profession");
    const userpassword = document.getElementById("user-password");
    const lavleFocus = document.querySelectorAll("label");
    // const userContact = document.getElementById("user-contact");
    var userData = [];

    function loginForm() {
        loginSection.style.display = "block";
        overlay.style.display = "block";
        userList.style.display = "none";
        // formSection.style.display = "block";
        document.body.style.background = "";

    }

    function editProfileImg(x, y) {
        const profileImg = document.querySelector(x);
        const file = document.querySelector(y).files[0];
        // const userImg = document.querySelector(".user-img")
        // userProfileImg.style.border = "0";
        // userImg.style.border = "0";
        const reader = new FileReader();

        reader.addEventListener("load", function () {
            // convert image file to base64 string
            profileImg.src = reader.result;
        }, false);

        if (file) {
            reader.readAsDataURL(file);
        }

    }

    function removeForm() {
        if (userData.length == 0) {
            loginSection.style.display = "none";
            overlay.style.display = "none";
        } else {
            userList.style.display = "block";
            loginSection.style.display = "none";
            overlay.style.display = "none";
            document.body.style.background = "none";
        }
        form.reset();
        userProfileImg.src = "img/user3.jpg";

    }

    // goBack button
    function goBack() {
        userProfile.style.display = "none";
        userList.style.display = "block";
        overlay.style.display = "none";
        document.body.style.background = "none";
    }

    function InputFocus(el) {
        var inputLable = el.nextElementSibling;
        inputLable.classList.add("lable-focus");
        el.style.borderBottomss = "1px solid #03e9f4"
    }
    function InputBlur(el) {
        var inputLable = el.nextElementSibling;
        if (el.value == "") {
            inputLable.classList.remove("lable-focus");
        }
    }

    function submitData(e, el) {
        // var formLable = document.querySelectorAll(".form-label");
        e.preventDefault();
        var button = document.querySelector("#submit");
        button.innerHTML = "submiting.."

        const url = el.action
        // var x = urlString();
        var payLoad = payLoadObject();

        $.post(url, payLoad, function (data, status) {
            // alert("data save successfully !")
            toastNotification('data save successfully !!',true);
            button.innerHTML = "submit";
            CreatUserList();
            form.reset();
            userProfileImg.src = "img/user3.jpg";
        }).catch(function (e) {
            console.log("something is wrong!", e)
            // alert("something is wrong !");
            toastNotification('something is wrong !!',false);
            button.innerHTML = "submit";
        })
    }

    function payLoadObject() {
        var formFieldValues = document.querySelectorAll(".form-field");
        var x = "";
        var obj = {}
        for (i = 0; i < formFieldValues.length; i++) {
            var item = formFieldValues[i];
            var itemname = item.name;
            var itemvalue = item.value;
            if (itemname == "image") {
                itemvalue = userProfileImg.getAttribute('src');
            }
            obj[itemname] = itemvalue;
            // arr.push(itemname+":"+itemvalue);
            // obj[i]={infoname:value};
        }
        return JSON.stringify(obj);
    }


    function CreatUserList() {
        var isFormValid = formValidation();
        if (true || isFormValid === true) {
            creatList();
        }
        document.body.style.background = "none";
    }

    function formValidation() {
        var x = userEmail.value.indexOf("@");
        // const contLength = userContact.value;
        const passwordLength = userpassword.value;
        if (userName.value == "") {
            alert("name can't be empty")
            return false;
        }
        else if (x < 3) {
            alert("enter valid email address")
            return false;
        }
        else if (userprofession.value == "select your profession") {
            alert("profession can't be empty")
            return false;
        }
        else if (passwordLength.length < 5) {
            alert("password must be 4 digit long")
            return false;
        }
        else {
            return true;
        }
    }

    function creatList() {
        var obj = {};
        const userProfileImg = document.querySelector(".profile-img");
        obj.name = userName.value;
        obj.email = userEmail.value;
        obj.profession = userprofession.value;
        obj.img = userProfileImg.src;
        if (userProfileImg.currentSrc == "") {
            obj.img = "img/user3.jpg"
        }
        userData.push(obj);
        // var data = userData[count]
        var Ulist = document.createElement("div");
        Ulist.innerHTML =
            "<div class='profile-layout'>" +
            "<img src='" + obj.img + "' class='user-img'/>" +
            // "<i class='fa fa-user user-font' aria-hidden='true'></i>" +
            "<h2 id='user-display-name'>" + obj.name + "</h2>" +
            "<p id='profession'>" + obj.profession + "</p>" +
            "</div>";
        Ulist.classList.add("user");
        parentUserList.append(Ulist);
        userList.style.display = "block";
        applicationLayout.style.display = "none";
        // formSection.style.display = "none"
        // userProfileImg.style.border = "1px solid";
        loginSection.style.display = "none";
        overlay.style.display = "none";
        // this function for display user profile
        Ulist.addEventListener("click", function () {
            userList.style.display = "none";
            userProfile.style.display = "block";
            overlay.style.display = "block";
            document.body.style.background = "";
            var indexNo = userData.indexOf(obj);
            userProfile.innerHTML =
                "<i class='fas fa-trash-alt user-edit' onclick='deletUser(" + indexNo + ")'></i>" +
                "<i class='fas fa-user-edit user-edit' onclick='edit(" + indexNo + ")'></i>" +
                // "<i class='fa fa-user profile-font' aria-hidden='true'></i>" +
                "<img src='" + obj.img + "' class='p-img-editPage'/>" +
                "<i class=\"fas fa-user-edit user-edit-profileFont\"></i>" +
                "<input type='file'class='font-input' onchange='editProfileImg(\".p-img-editPage\",\".font-input\")'>" +
                "<h2>" + obj.name + "</h2>" +
                "<p id='profession'>" + obj.profession + "</p>" +
                "<p id='email'>" + obj.email + "</p>" +
                // "<p id ='contact'>" + obj.contact + "</p>" +
                "<button class='btn' onclick='goBack(true)'>Go Back</button>";
        })
        form.reset();
        userProfileImg.src = "img/user3.jpg";
        //  userProfileImg.style.display = "none"
        for (i = 0; i < lavleFocus.length; i++) {
            var lableTag = lavleFocus[i];
            lableTag.classList.remove("lable-focus");
        }
    }

    //  edit peofile
    var alredyEditMode = false;
    function edit(indexNo) {
        // save editaed data here
        if (alredyEditMode == true) return;

        alredyEditMode = true;
        var editedData = userData[indexNo];


        var saveBtn = document.createElement("span");
        saveBtn.innerHTML = "<button class='save-btn btn'>save</button>"
        userProfile.append(saveBtn);
        var ProfileName = userProfile.querySelector("h2");
        var prfileProfession = userProfile.querySelector("#profession");
        var prfileEmail = userProfile.querySelector("#email");
        // var prfileContact = userProfile.querySelector("#contact");
        var profileImage = userProfile.querySelector(".p-img-editPage");


        ProfileName.innerHTML = "<input type='text' name='name' placeholder='Name' value='" + editedData.name + "' id='edit-name' class='edit-input'/>";
        prfileProfession.innerHTML = "<input type='text' name='' placeholder='Profession' value='" + editedData.profession + "' id='edit-profession' class='edit-input'/>";
        prfileEmail.innerHTML = "<input type='text' name='email' placeholder='Email' value='" + editedData.email + "' id='edit-email' class='edit-input'/>";
        // prfileContact.innerHTML = "<input type='number' placeholder ='Contact No' value='" + editedData.contact + "' id='edit-contact' class='edit-input'/>";
        profileImage.src = editedData.img;

        saveBtn.addEventListener("click", function () {
            alredyEditMode = false;
            var saveName = document.getElementById("edit-name");
            var saveProfession = document.getElementById("edit-profession");
            var saveEmail = document.getElementById("edit-email");
            // var saveContact = document.getElementById("edit-contact");
            var saveImage = profileImage;


            var userDisplayName = document.querySelectorAll("#user-display-name");
            var uderDisplayImage = document.querySelectorAll(".user img")

            editedData.name = saveName.value;
            editedData.profession = saveProfession.value;
            editedData.email = saveEmail.value;
            // editedData.contact = saveContact.value;
            editedData.img = saveImage.src;

            ProfileName.innerHTML = saveName.value;
            prfileProfession.innerHTML = saveProfession.value;
            prfileEmail.innerHTML = saveEmail.value;
            // prfileContact.innerHTML = saveContact.value;
            profileImage.src = saveImage.src;
            // userDisplayName

            userDisplayName[indexNo].innerHTML = editedData.name;
            uderDisplayImage[indexNo].src = editedData.img;
            saveBtn.style.display = 'none';
        })

    }

    // deletUser
    function deletUser(indexNo) {
        var deletAction = confirm(" you want to delet this user ? ")
        if (deletAction == true) {
            var userDisplayName = document.querySelectorAll("#user-display-name");
            if (indexNo > -1) {
                userData.splice(indexNo, 1);
                // var nodlistArr = Array.from(userDisplayName);
                // nodlistArr.splice(indexNo, 1);
                userDisplayName[indexNo].parentNode.parentNode.remove();
                userProfile.style.display = "none";
                userList.style.display = "block";
                overlay.style.display = "none";
                document.body.style.background = "none"
                // parentUserList.style.display="none"
            }
        }
    }
</script>

</html>